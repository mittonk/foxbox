INCLUDE "hardware.inc"

SECTION "Header", ROM0[$100]

    jp EntryPoint

    ds $150 - @, 0 ; Make room for the header
EntryPoint:
    ; Do not turn the LCD off outside of VBlank
WaitVBlank:
    ld a, [rLY]
    cp 144
    jp c, WaitVBlank

    ; Turn the LCD off
    ld a, 0
    ld [rLCDC], a

    ; Copy the tile data
    ld de, Tiles
    ld hl, $9000
    ld bc, TilesEnd - Tiles
    call Memcopy

    ; Copy the tilemap
    ld de, Tilemap
    ld hl, $9800
    ld bc, TilemapEnd - Tilemap
    call Memcopy

    ; Copy the player tile
    ld de, Player
    ld hl, $8000
    ld bc, PlayerEnd - Player
    call Memcopy

    ; Clear object storage
    ld a, 0
    ld b, 160
    ld hl, _OAMRAM
ClearOam:
    ld [hli], a
    dec b
    jp nz, ClearOam

    ; Init player object
    ld hl, _OAMRAM
    ld a, 96 + 16
    ld [hli], a
    ld a, 48 + 8
    ld [hli], a
    ld a, 0
    ld [hli], a
    ld [hli], a

    ; Turn the LCD on
    ld a, LCDCF_ON | LCDCF_BGON | LCDCF_OBJON
    ld [rLCDC], a

    ; During the first (blank) frame, initialize display registers
    ld a, %11100100
    ld [rBGP], a
    ld a, %11100100
    ld [rOBP0], a

Done:
    jp Done

; Copy bytes from one area to another.
; @param de: Source
; @param hl: Destination
; @param bc: Length
Memcopy:
    ld a, [de]
    ld [hli], a
    inc de
    dec bc
    ld a, b
    or a, c
    jp nz, Memcopy
    ret

Tiles:
	; 00 Outside
	dw `33333333
	dw `33333333
	dw `33333333
	dw `33333333
	dw `33333333
	dw `33333333
	dw `33333333
	dw `33333333

	; 01 Floor
	dw `00000000
	dw `00000000
	dw `00000000
	dw `00000000
	dw `00000000
	dw `00000000
	dw `00000000
	dw `00000000

	; 02 Wall
	dw `12111111
	dw `11111121
	dw `11121111
	dw `11111111
	dw `11211111
	dw `11111211
	dw `21111111
	dw `11111111

	; 03 Target
	dw `00000000
	dw `00000000
	dw `00022000
	dw `00222200
	dw `00222200
	dw `00022000
	dw `00000000
	dw `00000000

	; 04 Border, left
	dw `33322211
	dw `33322211
	dw `33322211
	dw `33322211
	dw `33322211
	dw `33322211
	dw `33322211
	dw `33322211

	; 05 Border, top
	dw `33333333
	dw `33333333
	dw `33333333
	dw `22222222
	dw `22222222
	dw `22222222
	dw `11111111
	dw `11111111

	; 06 Border, bottom
	dw `11111111
	dw `11111111
	dw `22222222
	dw `22222222
	dw `22222222
	dw `33333333
	dw `33333333
	dw `33333333

	; 07 Border, right
	dw `11222333
	dw `11222333
	dw `11222333
	dw `11222333
	dw `11222333
	dw `11222333
	dw `11222333
	dw `11222333

	; 08 Border, top-left
	dw `33333333
	dw `33333333
	dw `33333333
	dw `33333222
	dw `33332222
	dw `33322222
	dw `33322221
	dw `33322211

	; 09 Border, top-right
	dw `33333333
	dw `33333333
	dw `33333333
	dw `22233333
	dw `22223333
	dw `22222333
	dw `12222333
	dw `11222333

	; 0a Border, bottom-left
	dw `33322211
	dw `33322221
	dw `33322222
	dw `33332222
	dw `33333222
	dw `33333333
	dw `33333333
	dw `33333333

	; 0b Border, bottom-right
	dw `11222333
	dw `12222333
	dw `22222333
	dw `22223333
	dw `22233333
	dw `33333333
	dw `33333333
	dw `33333333

TilesEnd:

Tilemap:
	db $08, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $09, 0,0,0,0,0,0,0,0,0,0,0,0
	db $04, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $07, 0,0,0,0,0,0,0,0,0,0,0,0
	db $04, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $07, 0,0,0,0,0,0,0,0,0,0,0,0
	db $04, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $07, 0,0,0,0,0,0,0,0,0,0,0,0
	db $04, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $07, 0,0,0,0,0,0,0,0,0,0,0,0

	db $04, $00, $00, $00, $00, $00, $02, $02, $02, $02, $02, $00, $00, $00, $00, $00, $00, $00, $00, $07, 0,0,0,0,0,0,0,0,0,0,0,0
	db $04, $00, $00, $00, $00, $00, $02, $01, $01, $01, $02, $02, $02, $02, $00, $00, $00, $00, $00, $07, 0,0,0,0,0,0,0,0,0,0,0,0
	db $04, $00, $00, $00, $00, $00, $02, $01, $01, $01, $01, $01, $01, $02, $00, $00, $00, $00, $00, $07, 0,0,0,0,0,0,0,0,0,0,0,0
	db $04, $00, $00, $00, $00, $00, $02, $01, $01, $01, $01, $01, $03, $02, $00, $00, $00, $00, $00, $07, 0,0,0,0,0,0,0,0,0,0,0,0
	db $04, $00, $00, $00, $00, $02, $02, $02, $01, $02, $02, $02, $03, $02, $00, $00, $00, $00, $00, $07, 0,0,0,0,0,0,0,0,0,0,0,0

	db $04, $00, $00, $00, $00, $02, $01, $01, $01, $02, $00, $02, $03, $02, $00, $00, $00, $00, $00, $07, 0,0,0,0,0,0,0,0,0,0,0,0
	db $04, $00, $00, $00, $00, $02, $01, $01, $01, $02, $00, $02, $02, $02, $00, $00, $00, $00, $00, $07, 0,0,0,0,0,0,0,0,0,0,0,0
	db $04, $00, $00, $00, $00, $02, $01, $01, $01, $02, $00, $00, $00, $00, $00, $00, $00, $00, $00, $07, 0,0,0,0,0,0,0,0,0,0,0,0
	db $04, $00, $00, $00, $00, $02, $02, $02, $02, $02, $00, $00, $00, $00, $00, $00, $00, $00, $00, $07, 0,0,0,0,0,0,0,0,0,0,0,0
	db $04, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $07, 0,0,0,0,0,0,0,0,0,0,0,0

	db $04, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $07, 0,0,0,0,0,0,0,0,0,0,0,0
	db $04, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $07, 0,0,0,0,0,0,0,0,0,0,0,0
	db $0a, $06, $06, $06, $06, $06, $06, $06, $06, $06, $06, $06, $06, $06, $06, $06, $06, $06, $06, $0b, 0,0,0,0,0,0,0,0,0,0,0,0

TilemapEnd:

Player:
    dw `02000020
    dw `02122120
    dw `02311320
    dw `00211200
    dw `00122100
    dw `00211200
    dw `02111120
    dw `20202022
PlayerEnd:
